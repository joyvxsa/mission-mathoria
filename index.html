<script>
/* Stars */
for(let i=0;i<100;i++){
    let star=document.createElement("div");
    star.className="star";
    star.style.top=Math.random()*100+"%";
    star.style.left=Math.random()*100+"%";
    document.body.appendChild(star);
}

let currentAnswer=0;
let currentPlayer=1;
let steps1=0;
let steps2=0;
let totalSteps=15;
let moveAmount;
let isHardQuestion=false;

let questionTimer;
let questionTimeLimit=20000; // 20 seconds

/* CREATE VISIBLE CASES */
function createCases(){
    let path=document.getElementById("path");
    let width=path.offsetWidth;

    for(let i=0;i<totalSteps;i++){
        let box=document.createElement("div");
        box.style.position="absolute";
        box.style.width="30px";
        box.style.height="20px";
        box.style.border="2px solid white";
        box.style.borderRadius="6px";
        box.style.left=(width/totalSteps)*i+"px";
        box.style.top="-7px";
        path.appendChild(box);
    }
}

/* Generate Question Automatically */
function generateQuestion(){

    clearTimeout(questionTimer); // reset timer

    let hardChance=Math.random();
    let questionText="";

    if(hardChance < 0.3){
        // HARD question (2 cases)
        isHardQuestion=true;

        let a=Math.floor(Math.random()*9)+1;
        let b=Math.floor(Math.random()*9)+1;
        let c=Math.floor(Math.random()*9)+1;

        currentAnswer=a+b+c;
        questionText=a+" + "+b+" + "+c+" = ?";
        moveAmount=2;

    } else {
        // EASY question (1 case)
        isHardQuestion=false;

        let operations=["+","-","×"];
        let op=operations[Math.floor(Math.random()*3)];
        let a=Math.floor(Math.random()*9)+1;
        let b=Math.floor(Math.random()*5)+1;

        if(op==="+"){
            currentAnswer=a+b;
        }
        if(op==="-"){
            if(a<b){ [a,b]=[b,a]; }
            currentAnswer=a-b;
        }
        if(op==="×"){
            a=Math.floor(Math.random()*5)+1;
            b=Math.floor(Math.random()*5)+1;
            currentAnswer=a*b;
        }

        questionText=a+" "+op+" "+b+" = ?";
        moveAmount=1;
    }

    document.getElementById("question").innerText=
        "Player "+currentPlayer+" : "+questionText;

    document.getElementById("answer").value="";

    // START 20 SECOND TIMER
    questionTimer=setTimeout(()=>{
        switchPlayer();
        generateQuestion();
    }, questionTimeLimit);
}

/* Submit */
function submitAnswer(){

    clearTimeout(questionTimer); // stop timer when answered

    let userAnswer=parseInt(document.getElementById("answer").value);
    let message=document.getElementById("message");

    if(userAnswer===currentAnswer){

        message.innerText="BRAVO!";
        message.className="correct";
        message.style.display="block";

        if(currentPlayer===1){
            steps1+=moveAmount;
            moveRocket("rocket1",steps1);
        } else {
            steps2+=moveAmount;
            moveRocket("rocket2",steps2);
        }

    } else {
        message.innerText="OOPS!";
        message.className="wrong";
        message.style.display="block";
    }

    setTimeout(()=>{
        message.style.display="none";
        switchPlayer();
        generateQuestion();
    },1500);
}

function switchPlayer(){
    currentPlayer = currentPlayer===1 ? 2 : 1;
}

function moveRocket(id,steps){
    let pathWidth=document.getElementById("path").offsetWidth;
    let start=150;
    let distance=(pathWidth/totalSteps)*steps;
    document.getElementById(id).style.left=start+distance+"px";
}

/* Start game */
window.onload=function(){
    createCases();
    generateQuestion();
};
</script>
